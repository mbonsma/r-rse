# Build management and workflow {#build-management}

- With devtools
- Running local CRAN checks
- General workflow (load_all, test, check)
- Pre-push running test, build, and check
- Continuous integration using GitHub Actions

## Learning Objectives 

* Acquaint with the devtools functionality needed to manage an R package infrastructure
* Describe the CRAN checks' process and the different components
* Understand and set up the workflow for an R package validation
* Deploy a GitHub Action that runs a continuous integration workflow

## Outline

* `devtools`

    * Text: First explain why you don't want to manage this manually
    * Text: Then explain how `devtools` addresses those pain points

* CRAN checks 

    * Text: Explain what is CRAN
        * I believe it isn't defined before in the book.
    * Text: Explain why CRAN needs "checks"
    * Text: Explain the importance of passing a CRAN check even if the package is not available on CRAN
    * Text: Explain what does CRAN look in when performing a check
    * Text: Explain the output of a CRAN check
    * Code: `devtools::check()`
    * Exercise: Present an error with CRAN check that has not been previously seen in the book and have the learners find the solution
      * This will be expanded in detail once all of the chapters have been outlined

* R package build workflow

    * Text: Explain local functions and why to use `load_all()`
    * Text: Talk about tests and their purpose in the build process
    * Text: Explain the whole picture from document to load_all, tests and then check
    * Code: `devtools::load_all()` and `devtools::check()`

* Continuous Integration and GitHub Actions

    * Text: Explain what is continuous integration
    * Text: Explain GitHub Actions (https://github.com/features/actions)[https://github.com/features/actions]
    * Exercise: Deploy a sample GitHub Actions
      * Probably one that install R using the r-lib action is a good exercise
    * Code: `usethis::use_github_action_check_standard()`
    * Text: Explain how to navigate the result of the GitHub Action and the logs window

## Final exercise

The purpose of this exercise is for the participant to go through a cycle of iteration of:

- 1) checking if their package succeeds with R CMD
- 2) adding a function and the related steps
- 3) check if the package succeeds R CMD with the new additions
- 4) deploy a GitHub Action that performs the R CMD check every time they push to GitHub. 

The individual steps look like this:

<!-- COMMENT: Include check() after each step? -->

1. Check the package in its current state. Fix any notes, warnings, or errors.
  - `devtools::check()`
2. Add a function called `FIXME`
  - `usethis::use_r("FIXME")`
3. Add and build documentation for the `FIXME` function.
  - `devtools::document()`
4. Load all the functions and see if the `FIXME` function works.
  - `devtools::load_all()` 
5. Write and execute tests for the `FIXME` function.
  - `usethis::use_test("FIXME")`
  - `devtoools::test()`
6. Check that the package builds with the new additions
  - `devtools::check()`
7. Deploy a GitHub action to perform a standard R CMD check
  - `usethis::use_github_action_check_standard()`
